{"version":3,"file":"phpepl.js","sources":["phpepl.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","window","CodeMirror","$","lineNumbers","matchBrackets","mode","indentUnit","tabSize","autofocus","autoCloseBrackets",2,"timestamp","setOutput","text","isError","arguments","$output","html","removeClass","addClass","fadeOut","find","showLineError","line","each","Number","this","getPrettyFatalErrorMessage","responseText","splitTokens","err","lineNum","tokensToReplace","toLowerCase","indexOf","idx","val","replace","split","trim","../lib/timestamp",3,"editor","saveCode","localStorage","getValue","setItem","mixpanel","track","loadSavedCode","greeting","result","getItem","setValue","../editor",4,"now","Date","time","getHours","getMinutes","getSeconds","suffix","join",5,"sendingCode","ajax","type","url","evalURL","data","dataType","hostHas","part","location","host","isLiveEnv","onPHP5Version","processCode","fadeIn","done","processResponse","fail","processFatalError","editorHelpers","res","error","errorMsg","message","textLine","checkForShortcuts","which","ctrlKey","metaKey","preventDefault","storageHelpers","document","keydown","unload","bind","./editor","./helpers/EditorHelpers","./helpers/StorageHelpers"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nmodule.exports = window.CodeMirror($('#editor')[0], {\n  lineNumbers:       true,\n  matchBrackets:     true,\n  mode:              'text/x-php',\n  indentUnit:        2,\n  tabSize:           2,\n  autofocus:         true,\n  autoCloseBrackets: true\n});\n\n},{}],2:[function(require,module,exports){\nvar timestamp = require('../lib/timestamp');\n\n// Set the html of the output div\nmodule.exports.setOutput = function(text) {\n  var isError = !!arguments[1];\n  var $output = $('.output span');\n\n  $output.html(text).removeClass('error');\n\n  if (isError) { $output.addClass('error'); }\n\n  $('.spinner').fadeOut('fast');\n  $('.timestamp').find('span').html(timestamp());\n};\n\n// Highlights the line in the gutter with the error\nmodule.exports.showLineError = function(line) {\n  // Find the dom element in the gutter\n  $('.CodeMirror-linenumber').each(function() {\n    // If the cell's line number matches the error line\n    if (Number($(this).html()) === line) {\n      // Make the background red\n      $(this).addClass('error-gutter');\n      return;\n    }\n  });\n};\n\n// Helper to show the fatal errors nicely\n// Returns a list of the error text and line number that\n// generated the error.\n// Note: Implementation is fairly naive but works\nmodule.exports.getPrettyFatalErrorMessage = function(responseText) {\n  if (!responseText.length) { return; }\n\n  var text = responseText;\n  var tokensToReplace = ['\\n', /<br \\/>/g, /<b>/g, /<\\/b>/g, /(Fatal error: +)/g];\n  var splitTokens;\n  var err;\n  var line;\n  var lineNum;\n\n  // If the error message doesn't contain 'fatal error',\n  // then just print it\n  if (!responseText.toLowerCase().indexOf('fatal error')) {\n    return [responseText, 1];\n  }\n\n  $.each(tokensToReplace, function(idx, val) {\n    text = text.replace(val, '');\n  });\n\n  splitTokens = text.split('in');\n  err = splitTokens[0].trim();\n  splitTokens = text.split('on');\n  line = splitTokens[1].trim();\n\n  text = (err + ' on ' + line).trim();\n\n  lineNum = line.split(' ');\n  lineNum = Number(lineNum[1]);\n\n  return [text, lineNum];\n};\n\n},{\"../lib/timestamp\":4}],3:[function(require,module,exports){\nvar editor = require('../editor');\n\nmodule.exports.saveCode = function() {\n  if (!window.localStorage) { return; }\n\n  var code = editor.getValue();\n\n  window.localStorage.setItem('code', code);\n\n  // Show the saved message\n  $('.timestamp')\n    .find('span')\n      .html('Code Saved!');\n\n  window.mixpanel.track('Code Saved');\n};\n\n// Preload where you last left off\nmodule.exports.loadSavedCode = function() {\n  if (!window.localStorage) { return; }\n\n  var greeting = 'echo \"We\\'re running php version: \" . phpversion();';\n  var result = window.localStorage.getItem('code');\n  var code   = !result ? greeting : result;\n\n  editor.setValue(code);\n};\n\n},{\"../editor\":1}],4:[function(require,module,exports){\n/**\n * Returns a pretty timestamp (only time)\n * @return {String}\n */\nmodule.exports = function() {\n  var now = new Date();\n  var time = [now.getHours(), now.getMinutes(), now.getSeconds()];\n  var suffix = time[0] < 12 ? 'AM' : 'PM';\n\n  // Convert hour from military time\n  time[0] = time[0] < 12 ? time[0] : time[0] - 12;\n\n  // If hour is 0, set it to 12\n  time[0] = time[0] || 12;\n\n  // If seconds and minutes are less than 10, add a zero\n  for (var i = 1; i < 3; i++) {\n    if (time[i] < 10) {\n      time[i] = '0' + time[i];\n    }\n  }\n\n  return time.join(':') + ' ' + suffix;\n}\n},{}],5:[function(require,module,exports){\n'use strict';\n\nvar evalURL = 'eval/index.php';\n\nvar mixpanel = window.mixpanel || {};\nvar editor = require('./editor');\nvar editorHelpers = require('./helpers/EditorHelpers');\nvar storageHelpers = require('./helpers/StorageHelpers');\n\nstorageHelpers.loadSavedCode();\n\nif (!onPHP5Version() && isLiveEnv()) { $('.link-to-heroku').fadeIn('fast'); }\n\n$(document).keydown(checkForShortcuts);\n\n// Remember the code in the editor before navigating away\n$(window).unload(storageHelpers.saveCode.bind(storageHelpers));\n\n// Helpers\nfunction sendingCode(code) {\n  return $.ajax({\n    type:     'POST',\n    url:      evalURL,\n    data:     {code: code},\n    dataType: 'json'\n  });\n}\n\nfunction hostHas(part) {\n  return window.location.host.indexOf(part) !== -1;\n}\n\nfunction isLiveEnv() {\n  return hostHas('cloudcontrolled') || hostHas('herokuapp');\n}\n\nfunction onPHP5Version() {\n  return hostHas('herokuapp');\n}\n\n// Handles the sending of the code to the eval server\nfunction processCode() {\n  var code = editor.getValue();\n\n  if (!code.length) {\n    editorHelpers.setOutput('Please supply some code...');\n    return;\n  }\n\n  $('.spinner').fadeIn('fast');\n\n  // Track it\n  mixpanel.track('Code Run', {code: code});\n\n  sendingCode(code)\n    .done(processResponse)\n    .fail(processFatalError);\n}\n\nfunction processResponse(res) {\n  if (!res) { return; }\n\n  var result    = res.result;\n  var error     = res.error;\n  var errorMsg  = '';\n\n  if (!error) {\n    editorHelpers.setOutput(result);\n  } else {\n    if (error.line && error.message) {\n      // Show the line in red\n      editorHelpers.showLineError(error.line);\n\n      // Show the error message\n      errorMsg = 'Line ' + error.line + ': ';\n    }\n\n    errorMsg += error.message;\n\n    editorHelpers.setOutput(errorMsg, true);\n  }\n}\n\nfunction processFatalError(error) {\n  if (!error) { return; }\n\n  var textLine = editorHelpers.getPrettyFatalErrorMessage(error.responseText);\n\n  editorHelpers.setOutput(textLine[0], true);\n  editorHelpers.showLineError(textLine[1]);\n  mixpanel.track('Error', {error: error.responseText});\n}\n\nfunction checkForShortcuts(e) {\n  // CMD + Enter or CTRL + Enter to run code\n  if (e.which === 13 && (e.ctrlKey || e.metaKey)) {\n    processCode();\n    e.preventDefault();\n  }\n\n  // CMD + S or CTRL + S to save code\n  if (e.which === 83 && (e.ctrlKey || e.metaKey)) {\n    storageHelpers.saveCode();\n    e.preventDefault();\n    mixpanel.track('Save Shortcut');\n  }\n}\n\n},{\"./editor\":1,\"./helpers/EditorHelpers\":2,\"./helpers/StorageHelpers\":3}]},{},[5]);\n"]}